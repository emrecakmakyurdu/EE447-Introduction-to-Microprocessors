;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;				  MAIN OF THE Q5				  ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

PB_INP				EQU		0X4000503C

;LABEL			DIRECTIVE	VALUE				COMMENT	
				AREA main,	CODE,	READONLY,	ALIGN=2
				THUMB
					
				IMPORT		InitSysTick
				IMPORT		PORTB_Init
				IMPORT 		DELAY100
				EXPORT		__main

			
__main			PROC
				BL			InitSysTick
				BL			PORTB_Init
				MOV			R5,#1			;IF R5 = 1 CW, R5 = 2 CCW
				
LOOP			LDR			R0,=PB_INP			;PORTB_DATA REGISTERININ ADRESINI R0'YA KAYDEDIYORUM
				LDRB		R1,[R0]					;PORTB_DATA REGISTERINDEKI DEGERI R1'E KAYDEDIYORUM
				BL			DELAY100						;100MSEC BEKLIYORUM
				LDRB		R2,[R0]					;PORTB_DATA REGISTERINDEKI DEGERI R2'YE KAYDEDIYORUM
				CMP			R1,R2							;DEBOUNCING ICIN KARSILASTIRMA YAPIYORUM
				BNE			LOOP							;DEGILSE YANLISLIK OLMUS, TEKRAR INPUT ALIYORUM
				CMP			R1,#0X00						;R1 VE R2 AYNI OLMASINA RAGMEN 0X00 ISELER, HICBIR TUSA BASILMAMIS DEMEKTIR, TEKRAR INPUT ALIYORUM
				BEQ			LOOP		
				CPY			R4,R1
RELEASE			LDRB		R1,[R0]					;PORTB_DATA'DA SAKLANAN DEGERI R1'E YUKLUYORUM
				BL			DELAY100
				LDRB		R2,[R0]					;PORTB_DATA'DA SAKLANAN DEGERI R2'YE YUKLUYORUM
				CMP			R1,R2							;DEBOUNCING
				BNE			RELEASE
				CMP			R1,#0X00						;EGER HALA TUSA BASILI ISE BIRAKANA KADAR BEKLIYORUM, RELEASE'YE DONUYORUM
				BNE			RELEASE							;EGER TUS BIRAKILDIYSA, R1'E 0XF0 YUKLENIYOR VE BU LOOP'TAN CIKILIYOR
				CPYEQ		R5,R4
				B			LOOP
				
	
	
				ENDP
					
					
					
					
				END